{
  "swagger": "2.0",
  "info": {
    "version": "0.0.1",
    "title": "Pulse API",
    "description": "REST API for Pulse",
    "contact": {
      "name": "Brian Mendoza",
      "email": "bcmendoza@gmail.com"
    },
    "license": {
      "name": "License",
      "url": "https://github.com/bcmendoza/pulse/blob/master/LICENSE"
    }
  },
  "definitions": {
    "Stream": {
      "type": "object",
      "properties": {
        "owner": {
          "type": "string",
          "example": "hospital"
        },
        "unitType": {
          "type": "unitType",
          "example": "%"
        },
        "ratings": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/Rating"
          }
        },
        "current": {
          "$ref": "#/definitions/Pulse"
        },
        "historical": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Pulse"
          }
        }
      }
    },
    "Pulse": {
      "type": "object",
      "properties": {
        "score": {
          "type": "number",
          "format": "float",
          "example": 27.36
        },
        "timestamp": {
          "type": "string",
          "example": "2017-07-21T17:32:28Z",
          "format": "date-time"
        },
        "ratingLabel": {
          "type": "string",
          "example": "Critical"
        }
      }
    },
    "Rating": {
      "type": "object",
      "properties": {
        "label": {
          "type": "string",
          "example": "Critical"
        },
        "color": {
          "type": "string",
          "example": "#FF4500"
        },
        "lte": {
          "type": "number",
          "format": "float",
          "example": 33.3
        },
        "gte": {
          "type": "number",
          "format": "float",
          "example": 0.0
        }
      }
    },
    "Hospital": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "example": "hospital"
        },
        "children": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/Department"
          }
        },
        "stream": {
          "$ref": "#/definitions/Stream"
        }
      }
    },
    "Department": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "example": "department-ICU"
        },
        "children": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/Patient"
          }
        },
        "stream": {
          "$ref": "#/definitions/Stream"
        }
      }
    },
    "Patient": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "example": "patient-39fd6a79-1791-4117-9d14-9a7b2118f930"
        },
        "children": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/Metric"
          }
        },
        "stream": {
          "$ref": "#/definitions/Stream"
        }
      }
    },
    "Metric": {
      "type": "object",
      "properties": {
        "stream": {
          "$ref": "#/definitions/Stream"
        }
      }
    },
    "AddDepartmentOrPatient": {
      "type": "object",
      "properties": {
        "department": {
          "type": "string",
          "example": "ICU"
        }
      }
    },
    "AddMetric": {
      "type": "object",
      "properties": {
        "department": {
          "type": "string",
          "example": "ICU"
        },
        "patient": {
          "type": "string",
          "example": "patient-39fd6a79-1791-4117-9d14-9a7b2118f930"
        },
        "metric": {
          "type": "string",
          "example": "Heart Rate"
        },
        "unitType": {
          "type": "string",
          "example": "BPM"
        }
      },
      "required": ["metric", "unitType"]
    },
    "AddMetricPulse": {
      "type": "object",
      "properties": {
        "department": {
          "type": "string",
          "example": "ICU"
        },
        "patient": {
          "type": "string",
          "example": "patient-39fd6a79-1791-4117-9d14-9a7b2118f930"
        },
        "metric": {
          "type": "string",
          "example": "Heart Rate"
        },
        "value": {
          "type": "number",
          "format": "float",
          "example": 93.26
        }
      },
      "required": ["department", "patient", "metric", "value"]
    },
    "CreatedResponse": {
      "type": "object",
      "properties": {
        "created": {
          "type": "string",
          "example": "NICU"
        }
      }
    },
    "Error": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32",
          "example": 404
        },
        "message": {
          "type": "string",
          "example": "Not Found"
        }
      }
    }
  },
  "paths": {
    "/summary": {
      "get": {
        "description": "Gets a summary object of the entire hospital",
        "tags": ["Summary"],
        "produces": ["application/json"],
        "operationId": "summary",
        "responses": {
          "200": {
            "description": "Summary Response",
            "schema": {
              "$ref": "#/definitions/Hospital"
            }
          },
          "default": {
            "description": "Error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        }
      }
    },
    "/departments": {
      "post": {
        "description": "Adds a new department to the hospital",
        "tags": ["Departments"],
        "consumes": ["application/json"],
        "produces": ["application/json"],
        "operationId": "departments",
        "parameters": [
          {
            "name": "AddDepartmentRequest",
            "in": "body",
            "description": "Add a department",
            "required": true,
            "schema": {
              "$ref": "#/definitions/AddDepartmentOrPatient"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "schema": {
              "$ref": "#/definitions/CreatedResponse"
            }
          },
          "default": {
            "description": "Error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        }
      }
    },
    "/patients": {
      "post": {
        "description": "Adds a new patient to a department. Patient ID autogenerated",
        "tags": ["Departments"],
        "consumes": ["application/json"],
        "produces": ["application/json"],
        "operationId": "departments",
        "parameters": [
          {
            "name": "AddPatientRequest",
            "in": "body",
            "description": "Add a patient",
            "required": true,
            "schema": {
              "$ref": "#/definitions/AddDepartmentOrPatient"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "schema": {
              "$ref": "#/definitions/CreatedResponse"
            }
          },
          "default": {
            "description": "Error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        }
      }
    },
    "/metrics": {
      "post": {
        "description": "Adds a new metric to a patient, entire department, or entire hospital",
        "tags": ["Departments"],
        "consumes": ["application/json"],
        "produces": ["application/json"],
        "operationId": "departments",
        "parameters": [
          {
            "name": "AddMetricRequest",
            "in": "body",
            "description": "Add a metric. To apply to all patients, leave 'patient' and 'department' keys empty. To apply to a department's patients, leave 'patient' empty. Otherwise, to apply to a patient, all fields are required.",
            "required": true,
            "schema": {
              "$ref": "#/definitions/AddMetric"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "schema": {
              "$ref": "#/definitions/CreatedResponse"
            }
          },
          "default": {
            "description": "Error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        }
      }
    },
    "/pulses": {
      "post": {
        "description": "Adds a metric pulse, updating all listening streams",
        "tags": ["Departments"],
        "consumes": ["application/json"],
        "produces": ["application/json"],
        "operationId": "departments",
        "parameters": [
          {
            "name": "AddMetricPulseRequest",
            "in": "body",
            "description": "Add a metric pulse",
            "required": true,
            "schema": {
              "$ref": "#/definitions/AddMetricPulse"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "schema": {
              "$ref": "#/definitions/CreatedResponse"
            }
          },
          "default": {
            "description": "Error",
            "schema": {
              "$ref": "#/definitions/Error"
            }
          }
        }
      }
    }
  }
}
